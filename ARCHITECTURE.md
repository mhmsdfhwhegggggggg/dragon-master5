# بنية نظام تطبيق Dragaan المتكامل

## 1. نظرة عامة
تم تصميم نظام Dragaan ليكون منصة قوية ومستقرة لإدارة عمليات Telegram الضخمة (استخراج وإضافة) مع التركيز على الأداء العالي وحماية الحسابات من الحظر.

## 2. المكونات الأساسية

### أ. الواجهة الأمامية (Mobile App)
- **التقنية**: Expo + React Native + NativeWind.
- **إدارة الحالة**: TanStack Query (React Query) مع tRPC.
- **التصميم**: عصري، يعتمد على ألوان شعار التطبيق (الأزرق المتدرج)، مع دعم كامل للوضع الليلي.

### ب. الخلفية (Backend Server)
- **التقنية**: Node.js + Express + tRPC.
- **قاعدة البيانات**: PostgreSQL مع Drizzle ORM.
- **إدارة المهام**: BullMQ مع Redis لمعالجة العمليات الضخمة في الخلفية لضمان عدم تأثر أداء التطبيق.
- **محرك Telegram**: مكتبة `telegram` (GramJS) مع نظام إدارة جلسات مشفر.

### ج. نظام مكافحة الحظر (Anti-Ban System)
- **Anti-Ban Core**: محرك ذكي يحسب درجة المخاطر لكل عملية.
- **Smart Delay**: نظام تأخير ديناميكي يحاكي السلوك البشري.
- **Proxy Intelligence**: إدارة ذكية للبروكسيات مع تبديل تلقائي عند الفشل.

## 3. تدفق العمليات (Workflows)

### استخراج وإضافة (Extract & Add)
1. يرسل المستخدم طلباً عبر التطبيق الجوال.
2. يتم إدراج المهمة في طابور BullMQ (Redis).
3. يقوم الـ Worker باستلام المهمة وتنفيذها على السيرفر.
4. يتم الاستخراج باستخدام `IndustrialExtractor` الذي يدعم القنوات العامة والخاصة.
5. يتم الفلترة في السيرفر (Server-side filtering) لتقليل استهلاك البيانات على الهاتف.
6. يتم الإضافة باستخدام `HighSpeedAdder` مع مراعاة قيود Telegram وFloodWait.
7. يتم تحديث التقدم فورياً في التطبيق عبر tRPC.

## 4. استراتيجية الأداء
- **Zero Device Load**: جميع العمليات الثقيلة تتم على السيرفر.
- **Streaming Data**: يتم نقل البيانات بين المكونات بنظام التدفق (Streaming) لتوفير الذاكرة.
- **Distributed Processing**: إمكانية تشغيل عدة Workers لتوزيع الحمل.

## 5. إدارة الحسابات
- **تجميع الحسابات المحظورة**: نظام تلقائي لرصد الحسابات المقيدة.
- **فك الحظر الذكي**: خوارزميات لتقديم طلبات فك الحظر ومتابعتها.
- **إزالة التكرار**: فحص تلقائي للحسابات المكررة بناءً على الـ ID أو رقم الهاتف.
